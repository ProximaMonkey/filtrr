<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Filtrr2 Events Tests</title>
    <link rel="stylesheet" href="../lib/qunit.css" type="text/css" media="screen" />
    <script type="text/javascript" src="../lib/jquery.min.js"/></script>
    <script type="text/javascript" src="../lib/qunit.js"></script>
    <script type="text/javascript" src="../src/filtrr2.js"></script>
    <script type="text/javascript" src="../src/events.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){ 

            test("Registering events.", function() {
                var events = new Filtrr.Events(),
                    ev1c = 0,
                    ev2c = 0;
                events.on("ev1", function() {
                     ev1c++; 
                });
                events.on("ev1", function() {
                     ev1c++;
                });
                events.on("ev2", function() {
                     ev2c++;
                });
                events.on("ev2", function() {
                     ev2c++;
                });
                events.on("ev2", function() {
                     ev2c++;
                });
                events.on("ev2", function() {
                     ev2c++;
                });
                events.trigger("ev1");
                events.trigger("ev2");
                equal(ev1c, 2);
                equal(ev2c, 4);
            });

            test("Registering events with attributes.", function() {
                var events = new Filtrr.Events();
                events.on("ev1", function(a) {
                    equal(a, 1);
                });
                events.on("ev1", function(a) {
                    equal(a, 1);
                });
                events.on("ev2", function(b, c) {
                    equal(b, 2);
                    equal(c, 3);
                });
                events.on("ev2", function(b, c) {
                    equal(b, 2);
                    equal(c, 3);
                });
                events.trigger("ev1", 1);
                events.trigger("ev2", 2, 3);
            });

            test("Registering events with context.", function() {
                var events = new Filtrr.Events();
                var ctxa = {
                    a: 1
                };

                var ctxb = {
                    b: 2
                };
                events.on("ev1", function(ev) {
                    console.log(this);
                    equal(this.a, 1);
                }, ctxa);
                events.on("ev2", function(ev) {
                    equal(this.b, 2);
                }, ctxb);
                events.trigger("ev1");
                events.trigger("ev2");
            });

            test("Unregistering events.", function() {
                var events = new Filtrr.Events(),
                    ev1c = 0,
                    ev2c = 0;
                var cb1 = function() {
                    ev1c++; 
                };
                var cb2 = function() {
                    ev1c++;
                }
                var cb3 = function() {
                    ev1c++;
                }
                var cb4 = function() {
                    ev2c++;
                }
                var cb5 = function() {
                    ev2c++;
                }
                var cb6 = function() {
                    ev2c++;
                }
                
                events.on("ev1", cb1);
                events.on("ev1", cb2);
                events.on("ev1", cb3);
                events.on("ev2", cb4);
                events.on("ev2", cb5);
                events.on("ev2", cb6);

                events.trigger("ev1");
                events.trigger("ev2");
                
                equal(ev1c, 3);
                equal(ev2c, 3);
                
                events.off("ev1", cb1);
                events.off("ev2", cb4);
                
                events.trigger("ev1");
                events.trigger("ev2");
                
                equal(ev1c, 5);
                equal(ev2c, 5);

                events.off("ev1");
                events.off("ev2");

                events.trigger("ev1");
                events.trigger("ev2");

                equal(ev1c, 5);
                equal(ev2c, 5);
            });

        });
    </script>
</head>
<body>
    <h1 id="qunit-header">Filtrr2 Test Suite</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>